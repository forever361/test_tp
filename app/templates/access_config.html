{% extends "base.html" %}

{% block title %}UI自动化 测试平台 - new test cases{% endblock %}

{% block js %}
<script src="/static/bootstrap-table-1.21.3/dist/bootstrap-table.min.js"></script>
<link href="/static/bootstrap-table-1.21.3/dist/bootstrap-table.min.css" rel="stylesheet"/>

<script src="/static/tanos/bootbox.all.min.js"></script>
<script src="/static/tanos/popper.js"></script>
<script src="/static/tanos/toastr.min.js"></script>
<link href="/static/tanos/toastr.min.css" rel="stylesheet"/>

<!-- Bootstrap Font Icon CSS -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.5.0/font/bootstrap-icons.css">

<!--<script src="/static/tanos/data_connect.js"></script>-->


{% endblock %}


{% block content %}
<div style="background-color: #eee; height:100%; width:100%; align-items: center; display:flex; ">
    <div style=" height:91%; width:100%; margin-left: 30px;  margin-right: 30px; margin-top: 10px; margin-bottom: 10px; "
         class="card">
        <div class="card-body" style="padding-bottom:10px;">
            <div class="container">
                <h4>User Permissions</h4>

                <!-- User List -->
                <div style="margin-top: 50px" class="row">
                    <div class="col">
                        <h6>Users:</h6>
                        <ul class="list-group">
                            <li class="list-group-item">
                                <div style="font-size:10px;margin-top: 10px; padding-left: 10px; padding-right: 10px; padding-top: 4px;padding-bottom: 4px;background-color: #e1f0ff; color: #1b5fcc;  display: inline-block; border-radius: 5px;">
                                    {{username}}
                                </div>
                            </li>
                            <!-- Add more user items here -->
                        </ul>
                    </div>
                </div>

                <!-- Permission Form -->
                <div style="margin-top: 20px" class="row">
                    <div class="col">
                        <h6>Team:</h6>
                        <form>
                            <div class="form-group">
                                <input type="checkbox" id="aPermission" name="aPermission" value="read">
                                <label>Admin</label>
                            </div>
                            <div class="form-group">
                                <input type="checkbox" id="gPermission" name="gPermission" value="write">
                                <label>Guest</label>
                            </div>
                            <div class="form-group">
                                <input type="checkbox" id="dPermission" name="dPermission" value="delete">
                                <label>DELOS_User</label>
                            </div>
                            <div class="form-group">
                                <input type="checkbox" id="cPermission" name="cPermission" value="delete">
                                <label>China_Data_Solution</label>
                            </div>
                            <!-- Add more permission checkboxes here -->
                            <button id='savebtn' style="margin-top: 20px" type="button" class="btn btn-primary">Save Change
                            </button>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>


<script>

    // 获取后端传来的值
var team = "{{team}}";

console.info(team)

// 勾选相应的复选框
if (team === "Admin") {
  document.getElementById("aPermission").checked = true;
} else if (team === "Guest") {
  document.getElementById("gPermission").checked = true;
} else if (team === "DelosUsers") {
  document.getElementById("dPermission").checked = true;
} else if (team === "ChinaDataSolution") {
  document.getElementById("cPermission").checked = true;
}
// 添加更多复选框的逻辑

$(document).ready(function() {
    // 监听保存按钮的点击事件
    $('#savebtn').click(function() {
        // 构建请求数据对象
        var data = {
            username: "{{ username }}",
            permissions: []
        };

        // 检查每个权限复选框是否被选中
        if ($('#aPermission').is(':checked')) {
            data.permissions.push('Admin');
        }
        if ($('#gPermission').is(':checked')) {
            data.permissions.push('Guest');
        }
        if ($('#dPermission').is(':checked')) {
            data.permissions.push('DELOS_User');
        }
        if ($('#cPermission').is(':checked')) {
            data.permissions.push('China_Data_Solution');
        }

        // 发送Ajax请求
        $.ajax({
            url: '/save_permissions',  // 后端处理保存权限的路由
            method: 'POST',
            data: JSON.stringify(data),
            contentType: 'application/json',
            success: function(response) {
                // 处理成功响应
                location.reload()
                toastr.success('change successfully!');


            },
            error: function(xhr, status, error) {
                // 处理错误响应
                toastr.error('failed to change.');
            }
        });
    });
});
</script>

{% endblock %}