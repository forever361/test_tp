{% extends "base.html" %}

{% block title %}UI自动化 测试平台 - new test cases{% endblock %}

{% block js %}
<script src="/static/bootstrap-table-1.21.3/dist/bootstrap-table.min.js"></script>
<link href="/static/bootstrap-table-1.21.3/dist/bootstrap-table.min.css" rel="stylesheet"/>

<script src="/static/tanos/bootbox.all.min.js"></script>
<script src="/static/tanos/popper.js"></script>
<script src="/static/tanos/toastr.min.js"></script>
<link href="/static/tanos/toastr.min.css" rel="stylesheet"/>

<!-- Bootstrap Font Icon CSS -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.5.0/font/bootstrap-icons.css">

<!--<script src="/static/tanos/data_connect.js"></script>-->


{% endblock %}




{% block content %}
<div style="background-color: #eee; height:100%; width:100%; align-items: center; display:flex; ">
    <div style=" height:91%; width:100%; margin-left: 30px;  margin-right: 30px; margin-top: 10px; margin-bottom: 10px; "
         class="card">
        <div class="card-body" style="padding-bottom:10px;">
            <div class="container">
                <h4>Team Management</h4>

                <!-- Permission Form -->
                <div style="margin-top: 70px" class="row">
                    <div class="d-flex justify-content-between mb-3">
                        <h5>Team Management</h5>
                        <button class="btn btn-primary">
                            Add Team
                        </button>
                    </div>
                    <div class="col">
                        <table class="table">
                            <thead>
                            <tr>
                                <th>Team Name</th>
                                <th>Edit</th>
                            </tr>
                            </thead>
                            <tbody>
                            {% for team in teams %}
                            <tr>
                                <td>{{ team.name }}</td>
                                <td>
                                    <button class="btn btn-primary edit-button" data-bs-toggle="offcanvas"
                                            data-bs-target="#team-profile-modal" data-team-id="{{ team.id }}">Edit
                                    </button>
                                </td>
                            </tr>
                            {% endfor %}
                            </tbody>
                        </table>

                    </div>
                </div>

                <!-- Current Team Section -->
                <div class="card" style="margin-top: 20px; padding: 10px;">
                    <div class="row">
                        <div class="col">
                            <div style="font-size: 15px; margin-top: 5px;">Current Team:</div>
                            <div style="font-size: 15px; margin-top: 10px; padding: 8px; background-color: #e1f0ff; color: #1b5fcc; display: inline-block; border-radius: 5px;">
                                {{ session.get('team', {}) }}
                            </div>
                        </div>
                    </div>
                </div>


            </div>
        </div>
    </div>
</div>

<!-- Offcanvas for Team Profile -->
<div class="offcanvas offcanvas-end" tabindex="-1" id="team-profile-modal" aria-labelledby="offcanvasRightLabel">
    <div class="offcanvas-header">
        <h5 class="offcanvas-title" id="offcanvasRightLabel">Team Profile</h5>
        <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close"></button>
    </div>
    <div class="offcanvas-body">
        <!-- Team profile information and management functionality -->

        <!-- User List -->
        <div class="user-list-table-container">
            <h6>User List</h6>
            <table class="table" id="user-list-table">
                <thead>
                    <tr>
                        <th>User ID</th>
                        <th>User Name</th>
                        <th>Action</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- User list will be dynamically populated using AJAX -->
                </tbody>
            </table>
        </div>

        <!-- Pagination -->
        <div class="d-flex justify-content-end mt-3">
            <nav id="pagination-container">
                <ul class="pagination"></ul>
            </nav>
        </div>
    </div>
</div>

<script>
    $(document).ready(function () {
        var currentPage = 1;
        var perPage = 6;

        // 监听 Edit 按钮的点击事件
        $('.edit-button').click(function () {
            // 获取团队的 ID
            var teamId = $(this).data('team-id');

            console.info(teamId);

            // 在此处执行打开抽屉和处理相关团队的逻辑
            // 可以使用 teamId 来标识要编辑的团队
            // ...
        });

        // 监听 Add User 按钮的点击事件
        $('#add-user-button').click(function () {
            // 显示用户表格
            $('#all-users-table').show();
        });

        // 通过 AJAX 获取用户列表
        function getUserList(page) {
            // 发起 AJAX 请求，从后端获取用户列表数据
            $.ajax({
                url: '/team/getUserList', // 替换为实际的后端接口地址
                method: 'GET',
                data: {
                    page: page,
                    per_page: perPage
                },
                success: function (response) {
                    // 清空用户列表
                    $('#user-list-table tbody').empty();

                    // 动态生成用户列表
                    response.users.forEach(function (user) {
                        var row = '<tr>' +
                            '<td>' + user.id + '</td>' +
                            '<td>' + user.name + '</td>' +
                            '<td>' +
                            '<button style="height: 25px; display: flex; align-items: center;" class="btn btn-danger delete-user-button" data-user-id="' + user.id + '"><i class="bi bi-trash"></i></button>' +
                            '</td>' +
                            '</tr>';

                        $('#user-list-table tbody').append(row);
                    });

                    // 更新分页器
                    updatePagination(response.totalPages, page);
                },
                error: function (error) {
                    console.error('Error:', error);
                }
            });
        }

        // 更新分页器
        function updatePagination(totalPages, currentPage) {
            var paginationContainer = $('#pagination-container');
            var pagination = paginationContainer.find('.pagination');

            // 清空分页器
            pagination.empty();

            // 添加上一页按钮
            if (currentPage > 1) {
                var previousPageButton = '<li class="page-item previous-page-button"><a class="page-link" href="#"><i class="bi bi-chevron-left"></i> Previous</a></li>';
                pagination.append(previousPageButton);
            }

            // 添加页码按钮
            for (var i = 1; i <= totalPages; i++) {
                var pageButton = '<li class="page-item page-button' + (i === currentPage ? ' active' : '') + '"><a class="page-link" href="#">' + i + '</a></li>';
                pagination.append(pageButton);
            }

            // 添加下一页按钮
            if (currentPage < totalPages) {
                var nextPageButton = '<li class="page-item next-page-button"><a class="page-link" href="#">Next <i class="bi bi-chevron-right"></i></a></li>';
                pagination.append(nextPageButton);
            }
        }

        // 监听 Delete User 按钮的点击事件
        $(document).on('click', '.delete-user-button', function () {
            var userId = $(this).data('user-id');
            console.info(userId)

            // 在此处执行删除用户的逻辑
            // 使用 userId 来标识要删除的用户
            // ...
        });

        // 监听上一页按钮的点击事件
        $(document).on('click', '.previous-page-button', function () {
            currentPage--;
            getUserList(currentPage);
        });

        // 监听下一页按钮的点击事件
        $(document).on('click', '.next-page-button', function () {
            currentPage++;
            getUserList(currentPage);
        });

        // 监听页码按钮的点击事件
        $(document).on('click', '.page-button', function () {
            var page = parseInt($(this).text());
            if (page !== currentPage) {
                currentPage = page;
                getUserList(currentPage);
            }
        });

        // 初始化页面时获取第一页的用户列表
        getUserList(currentPage);
    });
</script>








{% endblock %}
