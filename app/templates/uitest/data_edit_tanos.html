{% extends "base.html" %}

{% block title %}Flasky{% endblock %}

{% block content %}

<style type="text/css">
    .form-bg{
        background: #00b4ef;
    }
    .form-horizontal{
    font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;
        background: #fff;
        padding-bottom: 10px;
        border-radius: 5px;
        text-align: center;
    }

    .form-horizontal .heading{
        display: block;
        font-size: 15px;
        font-weight: 700;
        padding: 35px 0;
        border-bottom: 1px solid #f0f0f0;
        margin-bottom: 30px;
    }

    .form-horizontal .heading2{
        display: block;
        font-size: 15px;
        font-weight: 700;
        margin-bottom: 8px;
    }

    .form-horizontal .heading3{
        display: block;
        font-size: 15px;
        font-weight: 500;
        padding: 35px 0;
        border-bottom: 1px solid #f0f0f0;
        margin-bottom: 6px;
    }

    .form-horizontal .form-group{
        padding: 0 10px;
        margin: 0 0 5px 0;
        position: relative;
    }

    .form-horizontal .form-control{
        background: #f0f0f0;
        border: none;
        border-radius: 10px;
        box-shadow: none;
        padding:0 20px 0 45px;
        height: 30px;
        transition: all 0.3s ease 0s;
    }
    .form-horizontal .form-control:focus{
        background: #e0e0e0;
        box-shadow: none;
        outline: 0 none;
    }
    .form-horizontal .form-group i{
        position: absolute;
        top: 12px;
        left: 60px;
        font-size: 17px;
        color: #c8c8c8;
        transition: all 0.5s ease 0s;
    }
    .form-horizontal .form-control:focus + i{
        color: #00b4ef;
    }
    .form-horizontal .fa-question-circle{
        display: inline-block;
        position: absolute;
        top: 12px;
        right: 60px;
        font-size: 20px;
        color: #808080;
        transition: all 0.5s ease 0s;
    }
    .form-horizontal .fa-question-circle{
        color: #000;
    }
    .form-horizontal .main-checkbox{
        float: left;
        width: 20px;
        height: 20px;
        background: #11a3fc;
        border-radius: 50%;
        position: relative;
        margin: 5px 0 0 5px;
        border: 1px solid #11a3fc;
    }
    .form-horizontal .main-checkbox label{
        width: 20px;
        height: 20px;
        position: absolute;
        top: 0;
        left: 0;
        cursor: pointer;
    }
    .form-horizontal .main-checkbox label:after{
        content:"";
        width: 20px;
        height: 20px;
        position: absolute;
        top: 5px;
        left: 4px;
        border: 3px solid #fff;
        border-top: none;
        border-right:none;
        background: transparent;
        opacity: 0;
        -webkit-transform: rotate(-45deg);
        transform: rotate(-45deg);
    }
    .from-horizontal .main-checkbox input[type=checkbox]{
        visibility: hidden;
    }
    .from-horizontal .main-checkbox input[type=checkbox]:checked + label:after{
        opacity: 1;
    }
    .form-horizontal .text{
        float: left;
        margin-left: 7px;
        line-height: 20px;
        padding-top: 5px;
        text-transform: capitalize;
    }
    .form-horizontal .btn1{
        width: 80px;
        margin-top: 30px;
        //float: left;
        font-size: 14px;
        color: #777;
        background: #222222;
        border-radius: 10px;
        padding: 10px 25px;
        border: none;
        text-transform: capitalize;
        transition: all 0.5s ease 0s;
    }
    .form-horizontal .btn2{
        font-size: 14px;
        //width: 270px;
        color: #fff;
        background: #00b4ef;
        border: none;
        border-radius: 30px;
        box-shadow: none;
        //height: 30px;
        transition: all 0.3s ease 0s;
    }

    .form-horizontal .border{
        width: 500px;
        border: 2px dashed #808080;
        padding: 10px 10px 0 20px;
    }

    @media only screen and (max-width: 479px){
        .form-horizontal .form-group{
            padding: 0 25px;
        }
        .form-horizontal .form-group i{
            left: 45px;
        }
        .form-horizontal .btn{
            padding: 10px 20px;
        }
    }


</style>

<style>
    #loading {
        position: absolute;
        width: 300px;
        height: 250px;
        top: 50%;
        left: 50%;
        margin: -25px -150px;
        background-color: #FFFFFF;
        border: 1PX solid #CCCCCC;
        text-align: center;
        padding: 20px;
    }

</style>

<style>
        body{
            margin: auto;
            background-color: #f5f5f5;
        }
        .button{width: 200px;height: 50px;color:#FFFFFF;background-color: #1da1f2}
        .log{
            width: 90%;
            height: 542px;
            background-color: #0a0202;
            margin: 0 auto;
<!--            margin-top: 10px;-->
            padding-top: 30px;
            padding-bottom: 40px;
        }
        .log_text{
            height: 542px;
            margin-left: 10px;
            font-size: 10px;
            color: #00FF00;
            overflow-x: hidden;
            overflow-y: auto;
            word-wrap:break-word
        }

      .lay-msg-bg{
            background-color:#ff5722;
            border:1px solid #ff5722;
            color:#fff;
            text-align: center;
        }

    .lay-msg-bg-gr{
            background-color:#5fb878;
            border:0 solid #5fb878;
            color:#fff;
            padding:5px;
            text-align: center;
            vertical-align:middle;
            display:table-cell
        }

</style>


<!--下面两个是使用Code Mirror必须引入的-->
<link rel="stylesheet" href="./static/codemirror/lib/codemirror.css"/>
<script src="./static/codemirror/lib/codemirror.js"></script>
<!--Java代码高亮必须引入-->
<!--<script src="./static/codemirror/mode/clike/clike.js"></script>-->
<!--<script src="./static/codemirror/mode/python/python.js"></script>-->
<script src="./static/codemirror/addon/edit/matchbrackets.js"></script>
<script src=./static/codemirror/mode/python/python.js></script>

<!--引入css文件，用以支持主题-->
<link rel="stylesheet" href="./static/codemirror/theme/abbott.css"/>
<link rel="stylesheet" href="./static/codemirror/theme/3024-night.css"/>
<link rel="stylesheet" href="./static/codemirror/theme/3024-day.css"/>
<link rel="stylesheet" href="./static/codemirror/theme/abbott.css"/>
<link rel="stylesheet" href="./static/codemirror/theme/abbott.css"/>
<link rel="stylesheet" href="./static/codemirror/theme/abbott.css"/>


<!-- bootstrap-select -->
<link href="{{ buildStaticUrl('/bootstrap-select-1.13.14/dist/css/bootstrap-select.min.css') }}" rel="stylesheet"/>
<script src="{{buildStaticUrl('/bootstrap-select-1.13.14/dist/js/bootstrap-select.min.js') }}"></script>
<!--<script src="{{buildStaticUrl('/bootstrap-select-1.13.14/dist/js/i18n/defaults-*.min.js') }}"></script>-->


<div class="row">
    <form method="POST">
        <div class="col-md-8" style="margin-left: 50px;margin-top: 20px;">

            <div>
                <label class="col-md-6" style="text-align: left;display:block; font-weight:bold; font-size:17px">Job
                    Configuration</label>
                <button style="float:right" type="button" class="btn  btn-primary">
                    <span class="glyphicon glyphicon-plus"> </span>

                </button>
            </div>
            <br/><br/>

            <div class="row panel panel-info " style="text-align: center;">
                <div class="panel-heading">Validation job 1</div>
                <div class="panel-body" style="text-align: left;">

                    <div class="col-md-6">
                        <label class="col-md-12 control-label">Source</label>
                        <div class="col-md-3" style="padding-top: 5px;">
                            <b style="color:red">*</b> Data point
                        </div>

                        <select name="select1" class="selectpicker col-md-9" data-live-search="true">
                            <option>pg-point1</option>
                            <option>pg-point2</option>
                            <option>test-point3</option>
                            <option>test-point4</option>
                            <option>test-point5</option>
                            <option>test-point6</option>
                        </select>

                        <p class="col-md-3 control-label" style="padding-top: 5px;">Condition</p>
                        <div class="col-md-9" style="padding-top: 5px;">
                            <input type="text" class=" form-control " placeholder="source where condition"
                                   aria-describedby="basic-addon1">
                        </div>
                    </div>


                    <div class="col-md-6">
                        <label class="col-md-12 control-label">Target</label>
                        <div class="col-md-3" style="padding-top: 5px;">
                            <b style="color:red">*</b> Data point
                        </div>
                        <select name="select2" class="selectpicker col-md-9" data-live-search="true">
                            <option>pg-point2</option>
                            <option>ali-point1</option>
                            <option>ali-point2</option>
                            <option>test-point4</option>
                            <option>test-point5</option>
                            <option>test-point6</option>
                        </select>

                        <p class="col-md-3 control-label" style="padding-top: 5px;">Condition</p>
                        <div class="col-md-9" style="padding-top: 5px;">
                            <input type="text" class=" form-control " placeholder="target where condition"
                                   aria-describedby="basic-addon1">
                        </div>
                    </div>

                    <div class="col-md-12">
                        <hr style="filter: alpha(opacity=100,finishopacity=0,style=3)" width="100%" color="#6f5499"
                            size="3"/>
                        <label class="col-md-12">Rules</label>

                        <div style="display:flex; width:100%; justify-content: start; align-items: center; padding-left:10px">
                            <p style="width:12.5% ">Select rules</p>
                            <select name="select_rule" id="select_rule" style="width:100%; min-width: 817px"
                                    class="selectpicker col-md-12" multiple
                                    data-live-search="true"
                                    data-actions-box="true">
                                <option selected >Default</option>
                                <option>Check-table-header</option>
                                <option>Check-count</option>
                                <option>Check-the-first-200-rows</option>
                                <option>Check-the-first-500-rows</option>
                                <option>Check-the-first-1000-rows</option>
                            </select>
                        </div>


                        <div style="display:flex; width:100%; justify-content: start; align-items: center; padding-left:12px; padding-top:5px">
                            <p style="width:12.5% ">Custom rules</p>
                            <input style="width:86%; " type="text" class=" form-control " placeholder="undefined"
                                   aria-describedby="basic-addon1">
                        </div>


                        <div style="display:flex; width:100%; justify-content: start; align-items: center; padding-left:12px; padding-top:5px">
                            <b style="color:red; ">*</b> <span style="width:12% ">&nbsp;By fields </span>
                            <input name="field" style="width:86%; " type="text" class=" form-control " placeholder="the columns used as the checking basis"
                                   aria-describedby="basic-addon1" value={{field}}>
                        </div>


                    </div>

                </div>
            </div>


            <div style="width:400px; margin: auto; text-align: center">

                <button type="button" name="Back" value="Back" class="btn btn-primary"
                        style="margin-top: 20px;float:left; width:80px"
                        onclick="window.location.href=('/api_data_test_cases')">Back
                </button>

                <button type="submit" name="Save" value="Save" class="btn btn-primary"
                        style="margin-top: 20px; width:80px ">Save
                </button>

                <button type="button" id="Run" class="btn btn-primary" style="margin-top: 20px;float:right;width:80px;"
                        onclick="getPublicFunctions2()">Run
                </button>

            </div>

            <!--        <div id="loading" style="display:none" align="middle">-->
            <!--            <img src="./static/loading.gif" height="150" align="middle">-->
            <!--            <div style="color:#00b4ef">Testing...please wait a moment.</div>-->
            <!--        </div>-->

        </div>


        <div class="col-md-3" style="margin-left: 10px;margin-top: 20px;">

            <div>
                <span style="text-align: center;display:block; font-weight:bold; font-size:17px">Test Log</span>
            </div>
            <br/>
            <!-- begin code -->

            <div class="log">
                <div class="log_text" id='log_list' style="padding-right:10px">
                    <div id="log_text"></div>
                </div>

                <div style="width:200px; margin: auto; text-align: center">

                    <button type="submit" id="Report" name="Report" value="Report" class="btn btn-primary"
                            style="margin-top: 20px; width:100px;display:none;">Check report
                    </button>
                    <div>
                    </div>

                    <!-- end code-->
                </div>
            </div>
        </div>

    </form>
</div>


<script>
    var time
      // 创建一个元素节点
    function insertAfter( newElement, targetElement ){ // newElement是要追加的元素targetElement 是指定元素的位置
        var parent = targetElement.parentNode; // 找到指定元素的父节点
        parent.appendChild( newElement, targetElement );
    };

    function log(){
        clearTimeout(time) // 清空定时器
        var log_null = 0 //存放空日志次数
        var div = document.getElementById('log_list') //找到存放日志的块
        div.innerHTML = "<div id='log_text'></div>" // 每次跑清空div内内容

<!--        $.post('/generation_log',{},function (){-->
<!--        }) //请求生成日志接口-->
        // 生成定时器
        time = setInterval(function (){
            $.get('/get_log',{},function (data){ //请求获取日志接口获取日志
                if (data.log_type == 3){ //如果获取的是空日志log_null次数加1
                    log_null ++
                    if (log_null >= 2000    ){
                        clearTimeout(time) //如果连续10次获取的都是空日志清除定时任务
                    }
                    return
                }
                if (data.log_type == 2){ //如果获取到新日志
                    for (i=0;i<data.log_list.length;i++){ //遍历日志
                        var p = document.createElement("p") //生成一个p标签
                        p.innerHTML = data.log_list[i] //日志存放到P标签内
                        var header = document.getElementById('log_text')
                        insertAfter(p,header) //将p标签添加到log_text div中
                        div.scrollTop = div.scrollHeight //滚动条实时显示到底部
                    }
                    log_null = 0 //日志为空次数清0
                }

            })
        },1500) //每1秒钟执行一次
    }
    document.getElementById('Run').addEventListener("click",log) //点击开始按钮开始执行

    function stoptimer(){
        clearInterval(time)
    }


</script>


<script>

function getPublicFunctions2(){
     var cases = []
     $.ajax(
        {
          url: "/runtest_tanos.json",
          type: "post",
          dataType:"json",
          data:{"code":"code", "code1":"code1"},
          async : true,
          beforeSend:function()
          {
            $('#Report').hide();
            return true;
          },
          success:function(data)
          {
            if (data.msg == "run success!"){
                layer.msg(data.msg,{time:2000,
                        area:['380px','66px'],
                        offset:'rt',
                        anim:1,
                        skin:'lay-msg-bg-gr'
                                 });
            } else {
                    layer.msg(data.msg,{time:2000,
                        area:['380px','66px'],
                        offset:'rt',
                        anim:1,
                        skin:'lay-msg-bg'
                                 });
            }
            if(data.returncode==0){
                $('#Report').show();
            }
            cases= data.msg;

          },
          error:function()
          {
           layer.msg(data.msg,{time:2000,
                    area:['380px','66px'],
                    offset:'rt',
                    anim:1,
                    skin:'lay-msg-bg'
                             });
            setTimeout(stoptimer(),5000);
          },
          complete:function()
          {
            setTimeout(stoptimer(),5000);
          }
    });

    return cases;
}

</script>

<script>

    var selectElement = document.getElementById('select_rule');
    selectElement.value='{{select_rule}}'

</script>


{% if message %}

<script>

var msg = "{{ message }}";
if (msg == "Save success!"){
    layer.msg(msg,{time:2000,
            area:['380px','66px'],
            offset:'rt',
            anim:1,
            skin:'lay-msg-bg-gr'
                     });
} else {
        layer.msg(msg,{time:2000,
            area:['380px','66px'],
            offset:'rt',
            anim:1,
            skin:'lay-msg-bg'
                     });
}


</script>

{% endif %}

{% endblock %}