{% extends "base.html" %}

{% block title %}Flasky{% endblock %}

{% block js %}
<script src="/static/bootstrap-table-1.21.3/dist/bootstrap-table.min.js"></script>
<link href="/static/bootstrap-table-1.21.3/dist/bootstrap-table.min.css" rel="stylesheet"/>

<script src="/static/tanos/bootbox.all.min.js"></script>
<script src="/static/tanos/popper.js"></script>
<script src="/static/tanos/toastr.min.js"></script>
<link href="/static/tanos/toastr.min.css" rel="stylesheet"/>

    <!-- Latest Sortable -->



<!-- Bootstrap Font Icon CSS -->
<!--<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.5.0/font/bootstrap-icons.css">-->

<!--<script src="/static/tanos/data_connect.js"></script>-->


{% endblock %}

{% block content %}

<style>
  .green-card {
      background-color: #d4edda; /* Bootstrap success color */
    }
    .red-card {
      background-color: #f5c6cb; /* Bootstrap danger color */
    }

     .btn-container {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1rem;
    }


     .sticky-save {
            position: -webkit-sticky;
            position: sticky;
            bottom: 0;
            z-index: 1000;
            background-color: white;
            padding-top: 10px;
            padding-bottom: 10px;
            border-top: 1px solid #dee2e6;
        }


</style>


{#<style>#}
{#  .custom-table tbody tr {#}
{#    height: 500px; /* 设置每一行的高度，根据需要调整值 */#}
{#  }#}
{#</style>#}


{#<div style="background-color: #ef2f27;  width: 100%; display: flex; flex-direction: column; align-items: flex-start;">#}

{##}
    <ul class="nav nav-tabs">
      <li class="nav-item">
        <a class="nav-link" aria-current="page" href="/data_per_search_case?id={{ job_id }}">Job Phases</a>
      </li>
      <li class="nav-item">
        <a class="nav-link active" href="/data_per_config?id={{ job_id }}">Job Configure</a>
      </li>
    </ul>

    <div style=" margin: 20px; margin-bottom: 100px " class="card">
         <div class="card-body" style="padding:10px;">
            <!-- Default panel contents -->

   <div class="container mt-5">

        <!-- File Server Configuration -->
       <h4>File Server</h4>
        <div class="form-group">
            <label for="fileServerDatapoint1">File Server log congig 1</label>
            <select class="form-control" id="fileServerDatapoint1"></select>
        </div>
        <div class="form-group">
            <label for="fileServerDatapoint2">File Server log congig 2</label>
            <select class="form-control" id="fileServerDatapoint2"></select>
        </div>

        <!-- Juniper Configuration -->
        <h4>Juniper</h4>
        <p>No configuration needed.</p>

        <!-- ODS Configuration -->
        <h4>ODS</h4>
        <div class="form-group">
            <label for="odsDatapoint">ODS Datapoint</label>
            <select class="form-control" id="odsDatapoint"></select>
        </div>
        <div class="form-group">
            <label for="odsSystemCode">System Code</label>
            <input type="text" class="form-control" id="odsSystemCode">
        </div>
        <div class="form-group">
            <label for="odsSubSystemCode">Sub System Code</label>
            <input type="text" class="form-control" id="odsSubSystemCode">
        </div>
        <div class="form-group">
            <label for="odsBatchData">Batch Data</label>
            <input type="text" class="form-control" id="odsBatchData">
        </div>

        <!-- CDS Configuration -->
        <h4>CDS</h4>
        <div class="form-group">
            <label for="cdsDatapoint">CDS Datapoint</label>
            <select class="form-control" id="cdsDatapoint"></select>
        </div>
        <div class="form-group">
            <label for="cdsSystemCode">System Code</label>
            <input type="text" class="form-control" id="cdsSystemCode">
        </div>
        <div class="form-group">
            <label for="cdsSubSystemCode">Sub System Code</label>
            <input type="text" class="form-control" id="cdsSubSystemCode">
        </div>
        <div class="form-group">
            <label for="cdsBatchData">Batch Data</label>
            <input type="text" class="form-control" id="cdsBatchData">
        </div>

        <div class="sticky-save">
       <button class="btn btn-primary" id="saveButton" style="width: 150px">Save</button>
           </div>
    </div>

    <script>
        $(document).ready(function() {

            // Function to get URL parameter
            function getUrlParameter(name) {
                name = name.replace(/[\[]/, '\\[').replace(/[\]]/, '\\]');
                var regex = new RegExp('[\\?&]' + name + '=([^&#]*)');
                var results = regex.exec(location.search);
                return results === null ? '' : decodeURIComponent(results[1].replace(/\+/g, ' '));
            }

            // Get the job ID from the URL
            var jobId = getUrlParameter('id');

            // Function to load datapoints into select elements
            function loadDatapoints(selectElements) {
                $.ajax({
                    url: "/getMyPoint",
                    type: "GET",
                    success: function (data) {
                        var options = "";
                        for (let i = 0; i < data.length; i++) {
                            const option = data[i];
                            options += `<option value="${option.value}">${option.text}</option>`;
                        }
                        selectElements.forEach(function(selectElement) {
                            $(selectElement).empty().append(options);
                        });
                    },
                    error: function(error) {
                        console.error('Error fetching datapoints:', error);
                    }
                });
            }

              // Function to load configuration from database
            function loadConfiguration() {
                $.ajax({
                    url: "/loadDataPerConfiguration",
                    type: "GET",
                    success: function(data) {
                        $('#fileServerDatapoint1').val(data.fileServerDatapoint1);
                        $('#fileServerDatapoint2').val(data.fileServerDatapoint2);
                        $('#odsDatapoint').val(data.odsDatapoint);
                        $('#odsSystemCode').val(data.odsSystemCode);
                        $('#odsSubSystemCode').val(data.odsSubSystemCode);
                        $('#odsBatchData').val(data.odsBatchData);
                        $('#cdsDatapoint').val(data.cdsDatapoint);
                        $('#cdsSystemCode').val(data.cdsSystemCode);
                        $('#cdsSubSystemCode').val(data.cdsSubSystemCode);
                        $('#cdsBatchData').val(data.cdsBatchData);
                    },
                    error: function(error) {
                        console.error('Error loading configuration:', error);
                    }
                });
            }

            // Function to save configuration to database
            function saveConfiguration() {
                var config = {
                    jobId: jobId,
                    fileServerDatapoint1: $('#fileServerDatapoint1').val(),
                    fileServerDatapoint2: $('#fileServerDatapoint2').val(),
                    odsDatapoint: $('#odsDatapoint').val(),
                    odsSystemCode: $('#odsSystemCode').val(),
                    odsSubSystemCode: $('#odsSubSystemCode').val(),
                    odsBatchData: $('#odsBatchData').val(),
                    cdsDatapoint: $('#cdsDatapoint').val(),
                    cdsSystemCode: $('#cdsSystemCode').val(),
                    cdsSubSystemCode: $('#cdsSubSystemCode').val(),
                    cdsBatchData: $('#cdsBatchData').val()
                };

                $.ajax({
                    url: "/saveDataPerConfiguration",
                    type: "POST",
                    contentType: "application/json",
                    data: JSON.stringify(config),
                    success: function(response) {
                        alert('Configuration saved successfully!');
                    },
                    error: function(error) {
                        console.error('Error saving configuration:', error);
                    }
                });
            }

            // Select elements to be filled with datapoints
            var selectElements = [
                '#fileServerDatapoint1',
                '#fileServerDatapoint2',
                '#odsDatapoint',
                '#cdsDatapoint'
            ];

            // Load datapoints into select elements
            loadDatapoints(selectElements);

            // Load existing configuration from database when the page loads
            loadConfiguration();

            // Save configuration when the save button is clicked
            $('#saveButton').click(function() {
                saveConfiguration();
            });
        });
    </script>









{% if message %}

{% endif %}

{% endblock %}